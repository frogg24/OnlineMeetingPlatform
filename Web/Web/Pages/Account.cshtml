@page
@model Web.Pages.AccountModel
@{
    ViewData["Title"] = "Личный кабинет";
}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"] - Платформа мероприятий</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <!-- Удален скрипт Feather Icons -->
</head>
<body>
    @{
        await Html.RenderPartialAsync("Header");
    }

    <main class="main-content">
        <div class="container">
            @if (!string.IsNullOrEmpty(Model.StatusMessage))
            {
                <div class="alert alert-warning alert-dismissible fade show" role="alert">
                    @Model.StatusMessage
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            }

            <div class="dashboard-header">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <div class="d-flex align-items-center">
                            @{
                                var username = HttpContext.Request.Cookies["Username"];
                                var userEmail = HttpContext.Request.Cookies["UserEmail"];
                                var displayName = !string.IsNullOrEmpty(username)
                                ? username
                                : !string.IsNullOrEmpty(userEmail)
                                ? userEmail
                                : "Пользователь";
                                var firstLetter = displayName[0].ToString().ToUpper();
                            }

                            <div class="me-3">
                                <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center"
                                     style="width: 56px; height: 56px; font-size: 24px;">
                                    @firstLetter
                                </div>
                            </div>

                            <div>
                                <h1 class="welcome-title mb-2">
                                    Добро пожаловать, <span class="username-highlight">@displayName</span>!
                                </h1>
                                <p class="welcome-subtitle">Это ваш личный кабинет на платформе мероприятий</p>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4 text-md-end">
                        <div class="notification-widget d-inline-flex align-items-center gap-2 p-2 rounded-pill bg-opacity-15 border border-white border-opacity-25">
                            <div class="form-check form-switch mb-0">
                                <input class="form-check-input" type="checkbox" id="notificationToggle"
                                       @(Model.UserIsNotificationOn ? "checked" : "")> <!-- Вот это изменение -->
                                <label class="form-check-label small fw-medium" for="notificationToggle">
                                    <svg class="feather-icon me-1" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                                        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                                    </svg>
                                    Уведомления
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Раздел участника -->
            <div class="section-card card mb-5">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">
                        <!-- SVG иконка пользователей -->
                        <svg class="me-2" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        Раздел участника
                    </h3>
                </div>
                <div class="card-body">
                    @if (Model.ParticipantMeetings.Any())
                    {
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Название мероприятия</th>
                                        <th>Дата</th>
                                        <th>Ссылка</th>
                                        <th>Подробности</th> 
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var meeting in Model.ParticipantMeetings)
                                    {
                                        var participation = Model.UserMeetingParticipations.FirstOrDefault(mu => mu.MeetingId == meeting.Id);
                                        <tr>
                                            <td>@meeting.Title</td>
                                            <td>@meeting.Date.ToString("dd.MM.yyyy")</td>
                                            <td>
                                                @if (!string.IsNullOrEmpty(meeting.Link))
                                                {
                                                    <a href="@meeting.Link" target="_blank" class="text-truncate d-inline-block" style="max-width: 200px;">
                                                        @meeting.Link
                                                    </a>
                                                }
                                                else
                                                {
                                                    <span>Не указана</span>
                                                }
                                            </td>
                                            <td>
                                                <!-- Новая колонка с кнопкой -->
                                                <a href="/ViewMeeting/@meeting.Id" class="btn btn-outline-info btn-sm">
                                                    <!-- SVG иконка глаза -->
                                                    Подробности
                                                </a>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-4">
                            <!-- SVG иконка календаря -->
                            <svg width="48" height="48" class="mb-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            <h5>Вы не участвуете ни в каких мероприятиях</h5>
                            <p>Найдите интересные мероприятия и присоединяйтесь к ним!</p>
                            <a href="/Events" class="btn btn-primary">Найти мероприятия</a>
                        </div>
                    }
                </div>
            </div>

            <!-- Раздел организатора -->
            <div class="section-card card mb-5">
                <div class="card-header bg-success text-white">
                    <h3 class="mb-0">
                        <!-- SVG иконка календаря с плюсом -->
                        <svg class="me-2" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                            <line x1="10" y1="16" x2="14" y2="16"></line>
                            <line x1="12" y1="14" x2="12" y2="18"></line>
                        </svg>
                        Раздел организатора
                    </h3>
                </div>
                <div class="card-body">

                    @if (Model.UserMeetings.Any())
                    {
                        <div class="mb-3">
                            <a href="/CreateMeeting" class="btn btn-success">
                                <!-- SVG иконка плюса -->
                                <svg class="me-1" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                                Создать мероприятие
                            </a>
                        </div>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Название мероприятия</th>
                                        <th>Дата</th>
                                        <th>Описание</th>
                                        <th>Действия</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var meeting in Model.UserMeetings)
                                    {
                                        <tr>
                                            <td>@meeting.Title</td>
                                            <td>@meeting.Date.ToString("dd.MM.yyyy")</td>
                                            <td>
                                                @if (!string.IsNullOrEmpty(meeting.Description))
                                                {
                                                    <div class="text-truncate" style="max-width: 250px;"
                                                         title="@meeting.Description">
                                                        @meeting.Description
                                                    </div>
                                                }
                                                else
                                                {
                                                    <span>Без описания</span>
                                                }
                                            </td>
                                            <td>
                                                <div class="btn-group" role="group">
                                                    <a href="/EditMeeting/@meeting.Id" class="btn btn-outline-primary btn-sm">
                                                        <!-- SVG иконка редактирования -->
                                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                                        </svg>
                                                    </a>
                                                    <a href="/ViewMeeting/@meeting.Id" class="btn btn-outline-info btn-sm">
                                                        <!-- SVG иконка глаза -->
                                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                            <circle cx="12" cy="12" r="3"></circle>
                                                        </svg>
                                                    </a>
                                                    <button class="btn btn-outline-danger btn-sm" onclick="deleteEvent(@meeting.Id, '@meeting.Title')">
                                                        <!-- SVG иконка корзины -->
                                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                            <polyline points="3,6 5,6 21,6"></polyline>
                                                            <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"></path>
                                                            <line x1="10" y1="11" x2="10" y2="17"></line>
                                                            <line x1="14" y1="11" x2="14" y2="17"></line>
                                                        </svg>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-4">
                            <!-- SVG иконка календаря с плюсом -->
                            <svg width="48" height="48" class="mb-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                                <line x1="10" y1="16" x2="14" y2="16"></line>
                                <line x1="12" y1="14" x2="12" y2="18"></line>
                            </svg>
                            <h5>Вы не создавали мероприятий</h5>
                            <p>Создайте свое первое мероприятие и начните принимать участников!</p>
                            <a href="/CreateMeeting" class="btn btn-success">
                                <!-- SVG иконка плюса -->
                                <svg class="me-1" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                                Создать мероприятие
                            </a>
                        </div>
                    }
                </div>
            </div>
        </div>
    </main>

    <!-- Модальное окно подтверждения -->
    <div class="modal fade" id="confirmModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Подтверждение действия</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="modalMessage"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                    <button type="button" class="btn btn-danger" id="confirmAction">Подтвердить</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>